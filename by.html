<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>by</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f8f9fa;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 40px;
      margin-bottom: 20px;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls input, .controls button {
      font-size: 18px;
      padding: 4px 10px;
      margin-left: 10px;
      vertical-align: middle;
    }
    .controls input[type="number"] {
      width: 60px;
      text-align: center;
    }
    .scoreboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 24px;
      justify-items: center;
    }
    .column {
      background: white;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.1);
      text-align: center;
      width: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    .name-input {
      font-size: 22px;
      width: 100%;
      text-align: center;
      margin-bottom: 16px;
    }
    .points-display {
      font-size: 36px;
      font-weight: bold;
      color: green;
      margin-bottom: 12px;
      user-select: none;
      transition: transform 0.2s ease;
    }
    .count-display {
      font-size: 18px;
      color: #666;
      margin-bottom: 10px;
      user-select: none;
      display: flex;
      justify-content: center;
      gap: 6px;
      align-items: center;
      font-weight: 600;
    }
    .count-display span {
      user-select: none;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .btn {
      font-size: 16px;
      padding: 6px 10px;
      cursor: pointer;
      user-select: none;
    }
    .status {
      font-weight: bold;
      font-size: 20px;
      color: blue;
      min-height: 28px;
    }

    /* ポイント更新アニメーション */
    .points-display.animate {
      animation: pop 0.3s ease;
    }
    @keyframes pop {
      0% { transform: scale(1); color: green; }
      50% { transform: scale(1.3); color: gold; }
      100% { transform: scale(1); color: green; }
    }

    /* 勝利演出 */
    .column.win {
      animation: win-glow 1.5s ease infinite;
    }
    @keyframes win-glow {
      0%, 100% { box-shadow: 0 0 20px gold, 0 0 40px yellow; }
      50% { box-shadow: 0 0 40px gold, 0 0 80px yellow; }
    }

    /* 勝利時のキラキラ */
    .column.win::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 60%);
      animation: sparkle 2s linear infinite;
    }
    @keyframes sparkle {
      0% { transform: rotate(0deg); opacity: 0.7; }
      100% { transform: rotate(360deg); opacity: 0.7; }
    }
  </style>
</head>
<body>
  <h1>by</h1>
  <div class="controls">
    人数：<input type="number" id="playerCount" value="10" min="1" />
    勝ち抜け・誤答：<input type="number" id="mValue" value="5" min="1" />
    <button id="generateBtn">作成</button>
    <button id="resetAllBtn">リセット</button>
  </div>
  <div class="scoreboard" id="scoreboard"></div>

  <script>
    const scoreboard = document.getElementById("scoreboard");
    const mInput = document.getElementById("mValue");
    const playerCountInput = document.getElementById("playerCount");
    const resetAllBtn = document.getElementById("resetAllBtn");
    const generateBtn = document.getElementById("generateBtn");

    let playerStates = [];

    function animatePoints(pointsDisplay) {
      pointsDisplay.classList.add("animate");
      setTimeout(() => pointsDisplay.classList.remove("animate"), 300);
    }

    function createScoreboard(players) {
      scoreboard.innerHTML = "";
      playerStates = [];

      for (let i = 0; i < players; i++) {
        const col = document.createElement("div");
        col.className = "column";
        col.innerHTML = `
          <input type="text" class="name-input" placeholder="名前" />
          <div class="points-display">0</div>
          <div class="count-display">
            <span class="correct">0</span>
            <span>×</span>
            <span class="m-minus-wrong">0</span>
          </div>
          <div class="buttons">
            <button class="btn btn-correct">正解</button>
            <button class="btn btn-wrong">誤答</button>
            <button class="btn btn-undo">戻る</button>
          </div>
          <div class="status"></div>
        `;

        let correct = 0;
        let wrong = 0;
        const history = [];

        const pointsDisplay = col.querySelector(".points-display");
        const correctSpan = col.querySelector(".correct");
        const mMinusWrongSpan = col.querySelector(".m-minus-wrong");
        const status = col.querySelector(".status");

        function updateDisplay() {
          const m = parseInt(mInput.value);
          const mMinusWrong = m - wrong >= 0 ? m - wrong : 0;
          const points = correct * mMinusWrong;

          correctSpan.textContent = correct;
          mMinusWrongSpan.textContent = mMinusWrong;
          pointsDisplay.textContent = points;
          animatePoints(pointsDisplay);

          if (points >= m * m) {
            col.classList.add("win");
            status.textContent = "勝ち！";
          } else {
            col.classList.remove("win");
            status.textContent = "";
          }
        }

        col.querySelector(".btn-correct").addEventListener("click", () => {
          correct++;
          history.push("correct");
          updateDisplay();
        });

        col.querySelector(".btn-wrong").addEventListener("click", () => {
          wrong++;
          history.push("wrong");
          updateDisplay();
        });

        col.querySelector(".btn-undo").addEventListener("click", () => {
          const last = history.pop();
          if (last === "correct") correct = Math.max(0, correct - 1);
          else if (last === "wrong") wrong = Math.max(0, wrong - 1);
          updateDisplay();
        });

        mInput.addEventListener("input", updateDisplay);

        playerStates.push({
          reset: () => {
            correct = 0;
            wrong = 0;
            history.length = 0;
            col.classList.remove("win");
            updateDisplay();
          }
        });

        scoreboard.appendChild(col);
        updateDisplay();
      }
    }

    generateBtn.addEventListener("click", () => {
      const count = parseInt(playerCountInput.value);
      createScoreboard(count);
    });

    resetAllBtn.addEventListener("click", () => {
      playerStates.forEach(player => player.reset());
    });

    // 初期作成
    createScoreboard(parseInt(playerCountInput.value));
  </script>
</body>
</html>
